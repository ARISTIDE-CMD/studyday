import type { AppLanguage } from '@/lib/settings-storage';

export type I18nParams = Record<string, string | number>;

const dictionaries = {
  fr: {
    common: {
      loading: 'Chargement...',
      retry: 'Reessayer',
      back: 'Retour',
      save: 'Enregistrer',
      add: 'Ajouter',
      cancel: 'Annuler',
      noDate: 'Sans date',
      today: 'aujourdhui',
      week: 'semaine',
      important: 'Important',
      details: 'Voir le detail',
      searchResource: 'Rechercher une ressource',
      networkErrorTitle: 'Erreur reseau',
      genericError: 'Une erreur est survenue.',
    },
    nav: {
      home: 'Accueil',
      tasks: 'Taches',
      resources: 'Ressources',
      announcements: 'Annonces',
      profile: 'Profil',
    },
    states: {
      auto: 'auto',
      loading: 'chargement',
      empty: 'vide',
      error: 'erreur',
    },
    priority: {
      low: 'Faible',
      medium: 'Moyenne',
      high: 'Elevee',
    },
    auth: {
      onboardingTitle: 'Organise ton quotidien etudiant',
      onboardingSubtitle:
        'Gere tes taches, centralise tes ressources et reste informe grace aux annonces.',
      onboardingCreateAccount: 'Creer un compte',
      onboardingSignIn: 'Se connecter',
      loginTitle: 'Connexion',
      loginSubtitle: 'Accede a ton espace etudiant.',
      signupTitle: 'Inscription',
      signupSubtitle: 'Cree ton compte et commence a t organiser.',
      email: 'Email',
      password: 'Mot de passe',
      passwordConfirm: 'Confirmation mot de passe',
      forgotPassword: 'Mot de passe oublie ?',
      continue: 'Continuer',
      noAccount: 'Pas encore de compte ?',
      hasAccount: 'Deja un compte ?',
      signIn: 'Se connecter',
      signUp: 'S inscrire',
      forgotTitle: 'Mot de passe oublie',
      forgotSubtitle: 'Saisis ton email pour recevoir un lien de reinitialisation.',
      forgotSend: 'Envoyer le lien',
      forgotBackToLogin: 'Retour a la connexion',
      resetTitle: 'Nouveau mot de passe',
      resetSubtitle: 'Definis ton nouveau mot de passe pour securiser ton compte.',
      resetUpdate: 'Mettre a jour',
      resetReadyError:
        'Session de reinitialisation introuvable. Ouvre le lien email depuis ce telephone.',
      resetOpenFromMail:
        'Ouvre ce screen depuis le lien recu par email pour activer la reinitialisation.',
      errRequiredFields: 'Tous les champs sont obligatoires.',
      errEmailRequired: 'Entre ton adresse email.',
      errEmailPasswordRequired: 'Email et mot de passe requis.',
      errPasswordMismatch: 'La confirmation du mot de passe ne correspond pas.',
      errPasswordShort: 'Le mot de passe doit contenir au moins 6 caracteres.',
      infoSignupVerifyMail: 'Compte cree. Verifie ton email puis connecte toi.',
      infoMailSent:
        'Email envoye. Ouvre le lien recu pour definir un nouveau mot de passe.',
      infoPasswordUpdated: 'Mot de passe mis a jour. Tu peux te reconnecter.',
      welcomeTitle: 'Bienvenue sur StudyDay',
      welcomeLoginMessage:
        'Centralise tes taches, ressources et annonces au meme endroit pour rester organise chaque jour.',
      welcomeSignupMessage:
        'Tu peux maintenant piloter tes taches, ressources et annonces depuis une seule application.',
    },
    postLogin: {
      kicker: 'Connexion etablie',
      title: 'Bienvenue, {name}',
      subtitle: 'Ton espace se prepare avec tes taches, ressources et annonces.',
      loadingDashboard: 'Chargement de ton dashboard...',
      skip: 'Passer',
      fallbackName: 'Etudiant',
    },
    home: {
      greeting: 'Bonjour, {name}',
      subtitle: 'Ton tableau du jour est pret',
      daySummary: 'Resume du jour',
      todo: 'A faire',
      overdue: 'En retard',
      nextTasks: 'Prochaines taches',
      seeAll: 'Voir tout',
      noTaskTitle: 'Aucune tache',
      noTaskDescription: 'Tu es a jour.',
      latestAnnouncement: 'Derniere annonce',
      noAnnouncementTitle: 'Aucune annonce',
      noAnnouncementDescription:
        'Aucune communication active pour le moment.',
      readAnnouncement: 'Lire l annonce',
      dashboardLoadError: 'Impossible de charger le tableau de bord.',
      fallbackName: 'Etudiant',
    },
    tasks: {
      title: 'Mes taches',
      subtitle: 'Organisation claire et priorites visibles',
      filterAll: 'toutes',
      filterTodo: 'a-faire',
      filterDone: 'terminees',
      emptyTitle: 'Aucune tache',
      emptyDescription: 'Tu es a jour pour cette periode.',
      emptyAdd: 'Ajouter une tache',
      emptyFilteredTitle: 'Aucun resultat',
      emptyFilteredDescription: 'Aucune tache pour ce filtre.',
      updateError: 'La mise a jour a echoue.',
      deleteError: 'Impossible de supprimer la tache.',
      loadError: 'Impossible de charger les taches.',
      swipeEdit: 'Modifier',
      swipeDelete: 'Supprimer',
    },
    resources: {
      title: 'Ressources',
      emptyTitle: 'Aucune ressource',
      emptyDescription:
        'Ajoute des notes, des liens ou des fichiers pour demarrer.',
      emptySearchTitle: 'Aucun resultat',
      emptySearchDescription: 'Aucune ressource ne correspond a la recherche.',
      loadError: 'Impossible de charger les ressources.',
      addedOn: 'Ajoute le {date}',
      actionTitle: 'Action ressource',
      edit: 'Modifier',
      delete: 'Supprimer',
      deleteError: 'Impossible de supprimer la ressource.',
      filterAll: 'tout',
      filterNote: 'note',
      filterLink: 'link',
      filterFile: 'file',
    },
    announcements: {
      title: 'Annonces',
      emptyTitle: 'Aucune annonce',
      emptyDescription:
        'Tu recevras ici les prochaines communications officielles.',
      loadError: 'Impossible de recuperer les annonces.',
    },
    announcementDetail: {
      notFound: 'Annonce introuvable.',
      errorLoad: 'Impossible de recuperer cette annonce.',
      emptyTitle: 'Introuvable',
      emptyDescription: 'Cette annonce n existe plus.',
      publishedOn: 'Publie le {date}',
    },
    profile: {
      title: 'Profil',
      fallbackName: 'Etudiant',
      unknownEmail: 'email inconnu',
      tasksCreated: 'Taches creees',
      tasksDone: 'Taches terminees',
      registrationDate: 'Date inscription',
      preferences: 'Preferences',
      language: 'Langue',
      theme: 'Theme',
      editProfile: 'Modifier le profil',
      signOut: 'Se deconnecter',
      french: 'Francais',
      english: 'English',
      system: 'Systeme',
      light: 'Clair',
      dark: 'Sombre',
      statsError: 'Impossible de lire les statistiques.',
    },
    taskEditor: {
      editTitle: 'Modifier tache',
      createTitle: 'Nouvelle tache',
      fieldTitle: 'Titre',
      fieldDescription: 'Description (optionnel)',
      fieldDueDate: 'Date limite (YYYY-MM-DD)',
      fieldPriority: 'Priorite',
      titlePlaceholder: 'Ex: Rendre le devoir de maths',
      descriptionPlaceholder: 'Ajouter des details',
      saveSuccess: 'Tache enregistree',
      requiredTitle: 'Le titre est obligatoire.',
      invalidDate: 'Format de date attendu: YYYY-MM-DD',
      saveError: 'Impossible d enregistrer la tache.',
    },
    resourceEditor: {
      editTitle: 'Modifier ressource',
      createTitle: 'Ajouter ressource',
      fieldTitle: 'Titre',
      fieldType: 'Type de ressource',
      fieldTags: 'Tags (separes par virgule)',
      titlePlaceholder: 'Ex: Resume chapitre 5',
      tagsPlaceholder: 'revision, examen',
      fileUrlLabel: 'URL fichier',
      contentLabel: 'Contenu',
      fileUrlPlaceholder: 'https://...',
      linkPlaceholder: 'URL ou description du lien',
      notePlaceholder: 'Contenu de la note',
      requiredTitle: 'Le titre est obligatoire.',
      emptyFileUrl: "Ajoute d'abord une URL de fichier.",
      uploadFileButton: 'Uploader le fichier vers Supabase',
      uploadError: "Impossible d'uploader le fichier vers Supabase.",
      saveError: 'Impossible d enregistrer la ressource.',
      saveSuccess: 'Ressource enregistree',
    },
    profileEditor: {
      title: 'Modifier profil',
      fieldFullName: 'Nom complet',
      fieldAvatarUrl: "URL de l'image profil",
      fullNamePlaceholder: 'Ex: Aris Dev',
      avatarPlaceholder: 'https://...',
      avatarHelp: 'Tu peux utiliser une image publique (JPG, PNG, WebP).',
      emptyAvatarUrl: "Ajoute d'abord une URL d'image.",
      uploadAvatarButton: "Uploader la photo vers Supabase",
      uploadError: "Impossible d'uploader la photo vers Supabase.",
      saveError: 'Impossible de mettre a jour le profil.',
      invalidAvatarUrl:
        "L'URL de l'image doit commencer par http:// ou https://",
      saveSuccess: 'Profil mis a jour',
      fallbackName: 'Etudiant',
    },
  },
  en: {
    common: {
      loading: 'Loading...',
      retry: 'Retry',
      back: 'Back',
      save: 'Save',
      add: 'Add',
      cancel: 'Cancel',
      noDate: 'No date',
      today: 'today',
      week: 'week',
      important: 'Important',
      details: 'View details',
      searchResource: 'Search resource',
      networkErrorTitle: 'Network error',
      genericError: 'An error occurred.',
    },
    nav: {
      home: 'Home',
      tasks: 'Tasks',
      resources: 'Resources',
      announcements: 'Announcements',
      profile: 'Profile',
    },
    states: {
      auto: 'auto',
      loading: 'loading',
      empty: 'empty',
      error: 'error',
    },
    priority: {
      low: 'Low',
      medium: 'Medium',
      high: 'High',
    },
    auth: {
      onboardingTitle: 'Organize your student day',
      onboardingSubtitle:
        'Manage tasks, centralize resources, and stay informed with announcements.',
      onboardingCreateAccount: 'Create account',
      onboardingSignIn: 'Sign in',
      loginTitle: 'Sign in',
      loginSubtitle: 'Access your student space.',
      signupTitle: 'Sign up',
      signupSubtitle: 'Create your account and get organized.',
      email: 'Email',
      password: 'Password',
      passwordConfirm: 'Confirm password',
      forgotPassword: 'Forgot password?',
      continue: 'Continue',
      noAccount: "Don't have an account?",
      hasAccount: 'Already have an account?',
      signIn: 'Sign in',
      signUp: 'Sign up',
      forgotTitle: 'Forgot password',
      forgotSubtitle: 'Enter your email to receive a reset link.',
      forgotSend: 'Send link',
      forgotBackToLogin: 'Back to login',
      resetTitle: 'New password',
      resetSubtitle: 'Set your new password to secure your account.',
      resetUpdate: 'Update',
      resetReadyError:
        'Reset session not found. Open the email link on this phone.',
      resetOpenFromMail:
        'Open this screen from the email link to enable password reset.',
      errRequiredFields: 'All fields are required.',
      errEmailRequired: 'Enter your email address.',
      errEmailPasswordRequired: 'Email and password are required.',
      errPasswordMismatch: 'Password confirmation does not match.',
      errPasswordShort: 'Password must contain at least 6 characters.',
      infoSignupVerifyMail: 'Account created. Check your email then sign in.',
      infoMailSent: 'Email sent. Open the link to set a new password.',
      infoPasswordUpdated: 'Password updated. You can sign in now.',
      welcomeTitle: 'Welcome to StudyDay',
      welcomeLoginMessage:
        'Keep your tasks, resources, and announcements in one place every day.',
      welcomeSignupMessage:
        'You can now manage tasks, resources, and announcements from one app.',
    },
    postLogin: {
      kicker: 'Connected',
      title: 'Welcome, {name}',
      subtitle: 'Your space is preparing your tasks, resources and announcements.',
      loadingDashboard: 'Loading your dashboard...',
      skip: 'Skip',
      fallbackName: 'Student',
    },
    home: {
      greeting: 'Hello, {name}',
      subtitle: 'Your day dashboard is ready',
      daySummary: 'Today summary',
      todo: 'To do',
      overdue: 'Overdue',
      nextTasks: 'Next tasks',
      seeAll: 'See all',
      noTaskTitle: 'No task',
      noTaskDescription: 'You are up to date.',
      latestAnnouncement: 'Latest announcement',
      noAnnouncementTitle: 'No announcement',
      noAnnouncementDescription:
        'No active communication at the moment.',
      readAnnouncement: 'Read announcement',
      dashboardLoadError: 'Unable to load dashboard.',
      fallbackName: 'Student',
    },
    tasks: {
      title: 'My tasks',
      subtitle: 'Clear organization and visible priorities',
      filterAll: 'all',
      filterTodo: 'to-do',
      filterDone: 'done',
      emptyTitle: 'No task',
      emptyDescription: 'You are up to date for this period.',
      emptyAdd: 'Add a task',
      emptyFilteredTitle: 'No result',
      emptyFilteredDescription: 'No task for this filter.',
      updateError: 'Update failed.',
      deleteError: 'Unable to delete task.',
      loadError: 'Unable to load tasks.',
      swipeEdit: 'Edit',
      swipeDelete: 'Delete',
    },
    resources: {
      title: 'Resources',
      emptyTitle: 'No resource',
      emptyDescription: 'Add notes, links, or files to get started.',
      emptySearchTitle: 'No result',
      emptySearchDescription: 'No resource matches your search.',
      loadError: 'Unable to load resources.',
      addedOn: 'Added on {date}',
      actionTitle: 'Resource action',
      edit: 'Edit',
      delete: 'Delete',
      deleteError: 'Unable to delete resource.',
      filterAll: 'all',
      filterNote: 'note',
      filterLink: 'link',
      filterFile: 'file',
    },
    announcements: {
      title: 'Announcements',
      emptyTitle: 'No announcement',
      emptyDescription:
        'You will receive official communications here.',
      loadError: 'Unable to fetch announcements.',
    },
    announcementDetail: {
      notFound: 'Announcement not found.',
      errorLoad: 'Unable to load this announcement.',
      emptyTitle: 'Not found',
      emptyDescription: 'This announcement no longer exists.',
      publishedOn: 'Published on {date}',
    },
    profile: {
      title: 'Profile',
      fallbackName: 'Student',
      unknownEmail: 'unknown email',
      tasksCreated: 'Tasks created',
      tasksDone: 'Tasks completed',
      registrationDate: 'Registration date',
      preferences: 'Preferences',
      language: 'Language',
      theme: 'Theme',
      editProfile: 'Edit profile',
      signOut: 'Sign out',
      french: 'French',
      english: 'English',
      system: 'System',
      light: 'Light',
      dark: 'Dark',
      statsError: 'Unable to read statistics.',
    },
    taskEditor: {
      editTitle: 'Edit task',
      createTitle: 'New task',
      fieldTitle: 'Title',
      fieldDescription: 'Description (optional)',
      fieldDueDate: 'Due date (YYYY-MM-DD)',
      fieldPriority: 'Priority',
      titlePlaceholder: 'Ex: Submit math assignment',
      descriptionPlaceholder: 'Add details',
      saveSuccess: 'Task saved',
      requiredTitle: 'Title is required.',
      invalidDate: 'Expected date format: YYYY-MM-DD',
      saveError: 'Unable to save task.',
    },
    resourceEditor: {
      editTitle: 'Edit resource',
      createTitle: 'Add resource',
      fieldTitle: 'Title',
      fieldType: 'Resource type',
      fieldTags: 'Tags (comma separated)',
      titlePlaceholder: 'Ex: Chapter 5 summary',
      tagsPlaceholder: 'review, exam',
      fileUrlLabel: 'File URL',
      contentLabel: 'Content',
      fileUrlPlaceholder: 'https://...',
      linkPlaceholder: 'URL or link description',
      notePlaceholder: 'Note content',
      requiredTitle: 'Title is required.',
      emptyFileUrl: 'Please enter a file URL first.',
      uploadFileButton: 'Upload file to Supabase',
      uploadError: 'Unable to upload file to Supabase.',
      saveError: 'Unable to save resource.',
      saveSuccess: 'Resource saved',
    },
    profileEditor: {
      title: 'Edit profile',
      fieldFullName: 'Full name',
      fieldAvatarUrl: 'Profile image URL',
      fullNamePlaceholder: 'Ex: Aris Dev',
      avatarPlaceholder: 'https://...',
      avatarHelp: 'You can use a public image (JPG, PNG, WebP).',
      emptyAvatarUrl: 'Please enter an image URL first.',
      uploadAvatarButton: 'Upload photo to Supabase',
      uploadError: 'Unable to upload photo to Supabase.',
      saveError: 'Unable to update profile.',
      invalidAvatarUrl:
        'Image URL must start with http:// or https://',
      saveSuccess: 'Profile updated',
      fallbackName: 'Student',
    },
  },
} as const;

export function getLocaleForLanguage(language: AppLanguage): string {
  return language === 'en' ? 'en-US' : 'fr-FR';
}

function resolveKey(dictionary: Record<string, unknown>, key: string): string | null {
  const value = key
    .split('.')
    .reduce<unknown>((acc, part) => {
      if (!acc || typeof acc !== 'object') return null;
      return (acc as Record<string, unknown>)[part];
    }, dictionary);

  return typeof value === 'string' ? value : null;
}

function interpolate(text: string, params?: I18nParams): string {
  if (!params) return text;
  return text.replace(/\{(\w+)\}/g, (_match, token: string) => {
    if (!(token in params)) return '';
    return String(params[token]);
  });
}

export function translate(language: AppLanguage, key: string, params?: I18nParams): string {
  const current = resolveKey(dictionaries[language], key);
  if (current) return interpolate(current, params);

  const fallback = resolveKey(dictionaries.fr, key);
  if (fallback) return interpolate(fallback, params);

  return key;
}
